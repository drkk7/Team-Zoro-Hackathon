<!-- Deadline Countdown Widget -->
<div class="deadline-widget">
    <div class="deadline-header">
        <h6 class="mb-0">
            <i class="fas fa-clock me-2"></i>Upcoming Deadlines
        </h6>
    </div>
    
    <div class="deadline-list" id="deadline-list">
        {% if upcoming_deadlines %}
            {% for assignment in upcoming_deadlines %}
            <div class="deadline-item" data-deadline="{{ assignment.deadline.isoformat() }}">
                <div class="deadline-content">
                    <div class="deadline-title">
                        <i class="fas fa-{% if assignment.assignment_type == 'quiz' %}question-circle{% elif assignment.assignment_type == 'homework' %}home{% elif assignment.assignment_type == 'project' %}project-diagram{% else %}file-alt{% endif %} me-2"></i>
                        {{ assignment.title }}
                    </div>
                    <div class="deadline-subject">{{ assignment.subject.name }}</div>
                    <div class="deadline-countdown" id="countdown-{{ assignment.id }}">
                        <span class="countdown-text">Loading...</span>
                    </div>
                </div>
                <div class="deadline-status">
                    {% if assignment.deadline < datetime.now() %}
                        <span class="badge bg-danger">Overdue</span>
                    {% elif assignment.deadline <= datetime.now() + timedelta(hours=24) %}
                        <span class="badge bg-warning">Due Soon</span>
                    {% else %}
                        <span class="badge bg-success">Upcoming</span>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="no-deadlines">
                <i class="fas fa-calendar-check"></i>
                <p class="mb-0">No upcoming deadlines</p>
            </div>
        {% endif %}
    </div>
    
    <div class="deadline-footer">
        <a href="{% if current_user.role == 1 %}{{ url_for('notifications.user_assignments', user_id=current_user.id) }}{% else %}{{ url_for('notifications.teacher_assignments', teacher_id=current_user.id) }}{% endif %}" 
           class="btn btn-sm btn-outline-primary w-100">
            <i class="fas fa-list me-1"></i>View All Assignments
        </a>
    </div>
</div>

<style>
.deadline-widget {
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    padding: 1.5rem;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    max-height: 400px;
    overflow: hidden;
}

.deadline-header {
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.deadline-header h6 {
    color: #ffffff;
    font-weight: 600;
}

.deadline-list {
    max-height: 250px;
    overflow-y: auto;
    margin-bottom: 1rem;
}

.deadline-item {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 0.75rem;
    margin-bottom: 0.5rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    border-left: 3px solid #00d4ff;
    transition: all 0.3s ease;
}

.deadline-item:hover {
    background: rgba(0, 212, 255, 0.1);
    transform: translateX(3px);
}

.deadline-item.overdue {
    border-left-color: #ff4757;
    background: rgba(255, 71, 87, 0.1);
}

.deadline-item.due-soon {
    border-left-color: #ffa502;
    background: rgba(255, 165, 2, 0.1);
}

.deadline-content {
    flex: 1;
}

.deadline-title {
    color: #ffffff;
    font-weight: 600;
    font-size: 0.9rem;
    margin-bottom: 0.25rem;
}

.deadline-subject {
    color: #cccccc;
    font-size: 0.8rem;
    margin-bottom: 0.25rem;
}

.deadline-countdown {
    font-size: 0.8rem;
    font-weight: 500;
}

.countdown-text {
    color: #00d4ff;
}

.countdown-text.overdue {
    color: #ff4757;
}

.countdown-text.due-soon {
    color: #ffa502;
}

.deadline-status {
    margin-left: 0.5rem;
}

.no-deadlines {
    text-align: center;
    padding: 2rem;
    color: #cccccc;
}

.no-deadlines i {
    font-size: 2rem;
    margin-bottom: 0.5rem;
    opacity: 0.5;
}

.deadline-footer {
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    padding-top: 1rem;
}

/* Scrollbar styling */
.deadline-list::-webkit-scrollbar {
    width: 4px;
}

.deadline-list::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 2px;
}

.deadline-list::-webkit-scrollbar-thumb {
    background: rgba(0, 212, 255, 0.5);
    border-radius: 2px;
}

.deadline-list::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 212, 255, 0.7);
}
</style>

<script>
function updateCountdowns() {
    const deadlineItems = document.querySelectorAll('.deadline-item');
    
    deadlineItems.forEach(item => {
        const deadlineStr = item.getAttribute('data-deadline');
        const deadline = new Date(deadlineStr);
        const now = new Date();
        const diffMs = deadline - now;
        
        const countdownElement = item.querySelector('.countdown-text');
        const statusElement = item.querySelector('.deadline-status .badge');
        
        if (diffMs <= 0) {
            // Overdue
            countdownElement.textContent = 'Overdue';
            countdownElement.className = 'countdown-text overdue';
            item.className = 'deadline-item overdue';
            if (statusElement) {
                statusElement.textContent = 'Overdue';
                statusElement.className = 'badge bg-danger';
            }
        } else {
            const days = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
            
            let countdownText = '';
            if (days > 0) {
                countdownText = `${days}d ${hours}h`;
            } else if (hours > 0) {
                countdownText = `${hours}h ${minutes}m`;
            } else {
                countdownText = `${minutes}m`;
            }
            
            countdownElement.textContent = countdownText;
            
            if (days === 0 && hours < 24) {
                // Due soon
                countdownElement.className = 'countdown-text due-soon';
                item.className = 'deadline-item due-soon';
                if (statusElement) {
                    statusElement.textContent = 'Due Soon';
                    statusElement.className = 'badge bg-warning';
                }
            } else {
                // Upcoming
                countdownElement.className = 'countdown-text';
                item.className = 'deadline-item';
                if (statusElement) {
                    statusElement.textContent = 'Upcoming';
                    statusElement.className = 'badge bg-success';
                }
            }
        }
    });
}

// Update countdowns immediately and then every minute
updateCountdowns();
setInterval(updateCountdowns, 60000);
</script>
